<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Archivio Scientifico No-Profit</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; line-height: 1.6; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .mission { color: #2c3e50; font-weight: bold; margin-bottom: 20px; border-left: 4px solid #3498db; padding-left: 10px; }
        button { background: #3498db; color: white; border: none; padding: 10px; cursor: pointer; border-radius: 5px; width: 100%; }
        #status { margin-top: 15px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="card">
    <div class="mission">Missione: Divulgazione Scientifica No-Profit</div>
    <h3>Caricamento Documenti</h3>
    <input type="file" id="fileInput" id="uploadBtn" style="margin-bottom: 15px;">
    <button onclick="upload()">Salva nel Database Scientifico</button>
    <div id="status"></div>
</div>

<script>
    // Configurazione diretta
    const _URL = "https://nygybfkstkevlfkmaqxa.supabase.co";
    const _KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55Z3liZmtzdGtldmxma21hcXhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NDUxMTAsImV4cCI6MjA4MjMyMTExMH0.aMvF_FneySS0-84Ts7VQlnoivfmUPUO4s8o-AK4KTJU";

    const supabaseClient = supabase.createClient(_URL, _KEY);

    async function upload() {
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const file = fileInput.files[0];

        if (!file) {
            status.innerText = "❌ Seleziona un file prima.";
            return;
        }

        status.style.color = "black";
        status.innerText = "⏳ Collegamento in corso...";

        try {
            // Caricamento nel bucket 'scienza'
            const fileName = `${Date.now()}_${file.name}`;
            const { data, error } = await supabaseClient.storage
                .from('scienza')
                .upload(fileName, file);

            if (error) throw error;

            status.style.color = "green";
            status.innerText = "✅ Successo! Il file è stato salvato nell'archivio.";
        } catch (err) {
            console.error(err);
            status.style.color = "red";
            // Se l'errore persiste, mostriamo il messaggio tecnico per capire meglio
            status.innerText = "❌ Errore: " + err.message;
        }
    }
</script>

</body>
</html>
